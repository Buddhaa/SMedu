<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cyber.smedu.mapper.DebateMapper">
	
	<!-- 관리자 학생성적관리 토론 채점점수 -->
	<select id="adminStudentGradeSubjectDebateScoreSelect"
		parameterType="java.util.Map"
		resultType="com.cyber.smedu.debate.domain.DebateScoreDomain">	
	SELECT 
		debate_score as debateScore,
		debate_score_date as debateScoreDate,
		debate_score_code as debateScoreCode
	FROM
		debate_score
	WHERE
		debate_code = #{debateCode}
	AND
		student_code = #{studentCode}
	
	</select>
	
	<!-- 관리자 학생성적관리 토론 답변 -->
	<select id="adminStudentGradeSubjectDebateResultSelect"
		parameterType="java.util.Map"
		resultType="com.cyber.smedu.debate.domain.DebateResultDomain">	
	SELECT 
		debate_result_code as debateResultCode,
		debate_code as debateCode,
		student_code as studentCode,
		debate_comment as debateComment,
		debate_register_date as debateRegisterDate
	FROM
		debate_result
	WHERE
		debate_code = #{debateCode}
	AND
		student_code = #{studentCode}
	
	</select>
<!-- 의기 -->
	<select id="professorStudentDebateCommentAndDateSelect"
		parameterType="String"
		resultType="com.cyber.smedu.debate.domain.DebateResultDomain">
	
	SELECT
		u.user_code AS userCode,
		u.user_name AS userName,
		d.student_code AS studentCode,
		d.debate_comment AS debateComment,
		d.debate_register_date AS debateRegisterDate
	FROM
		class_registration c
	INNER JOIN
		student s
	ON
		c.student_code = s.student_code
	INNER JOIN
		user u
	ON
		s.user_code = u.user_code
	INNER JOIN
		debate_result d
	ON
		d.student_code = s.student_code
	WHERE
		open_subject_code = #{openSubjectCode}
	AND 
		pay_state = 'T'
	ORDER BY
		d.debate_register_date ASC
	
	</select>
	
	<select id="professorStudentDebateSubjectAndContentSelect"
		parameterType="String"
		resultType="com.cyber.smedu.debate.domain.DebateDomain">
	
	SELECT
		debate_code AS debateCode,
		debate_subject AS debateSubject,
		debate_content AS debateContent,
		debate_register_date AS debateRegisterDate
	FROM
		debate
	WHERE
		open_subject_code = #{openSubjectCode}
	
	</select>
	
	<select id="professorSubjectSelectForDebate"
		parameterType="String"
		resultType="com.cyber.smedu.opensubject.domain.OpenSubjectDomain">
		
	SELECT
		open_subject_code AS openSubjectCode,
		subject_code AS subjectCode,
		cardinal_code AS cardinalCode,
		professor_code AS professorCode,
		subject_name AS subjectName
	FROM
		open_subject
	WHERE
		professor_code = #{professorCode}
		
	</select>
	
	<select id="professorDebateSelect"
		parameterType="String"
		resultType="com.cyber.smedu.debate.domain.DebateDomain">
		
	SELECT
		debate_code AS debateCode,
		professor_code AS professorCode,
		open_subject_code AS openSubjectCode,
		academic_calendar_code AS academicCalendarCode,
		debate_subject AS debateSubject,
		debate_content AS debateContent,
		debate_register_date AS debateRegisterDate
	FROM
		debate
	WHERE
		open_subject_code = #{openSubjectCode}
	</select>
	
	<update id="professorDebateUpdate"
		parameterType="com.cyber.smedu.debate.domain.DebateDomain">
		
	UPDATE 
		debate
	SET
		debate_subject = #{debateSubject},
		debate_content = #{debateContent}
	WHERE
		debate_code = #{debateCode}
		
	</update>

<!-- 토론 insert 쿼리 -->	
	<insert id="professorDebateInsert"
		parameterType="com.cyber.smedu.debate.domain.DebateDomain">
	
	INSERT INTO 
		debate
		(
		debate_code, 
		professor_code, 
		open_subject_code, 
		academic_calendar_code, 
		debate_subject, 
		debate_content, 
		debate_register_date
		)
	VALUES 
		(
		CONCAT('debate_code',(SELECT COUNT(d.debate_code)+1 FROM debate d)),
		(SELECT professor_code FROM open_subject WHERE open_subject_code = #{openSubjectCode}),
		#{openSubjectCode},
		(SELECT a.academic_calendar_code FROM open_subject o INNER JOIN academic_calendar a
		ON o.cardinal_code = a.cardinal_code WHERE open_subject_code = #{openSubjectCode} LIMIT 1 OFFSET 7),
		#{debateSubject}, 
		#{debateContent}, 
		NOW()
		)
	
	</insert>
	<!-- 우영 -->
	<select id="oneDebateList"
		parameterType="String"
		resultType="com.cyber.smedu.debate.domain.DebateDomain">
	SELECT
		debate_code AS debateCode,
		open_subject_code AS professorCode,
		open_subject_code AS openSubjectCode,
		academic_calendar_code AS academicCalendarCode,
		debate_subject AS debateSubject,
		debate_content AS debateContent,
		debate_register_date AS debateRegisterDate
	FROM
		debate
	WHERE
		open_subject_code =#{openSubjectCode}

</select>

<select id="debateResultList"
		parameterType="String"
		resultType="com.cyber.smedu.debate.domain.DebateResultDomain">

SELECT
	dr.debate_comment AS debateComment,
	dr.debate_register_date AS debateRegisterDate,
	u.user_code AS userCode,
	u.user_name AS userName
FROM
	debate_result dr
inner join
	student s
on
	dr.student_code = s.student_code
inner join
	user u
on
	u.user_code = s.user_code
where
	dr.debate_code = #{debateCode}

</select>


<!-- //////////////////11.10 입력 -->
	<insert id="debateResultAdd"
			parameterType="com.cyber.smedu.debate.domain.DebateResultDomain">
	INSERT INTO debate_result
			(
			debate_result_code, 
			debate_code, 
			student_code, 
			debate_comment, 
			debate_register_date
			)
		VALUES 
			(
			CONCAT('debate_result_code',(SELECT COUNT(r.debate_result_code)+1 FROM debate_result r)),
			#{debateCode}, 
			#{studentCode}, 
			#{debateComment}, 
			NOW()
			)	
	</insert>
<!-- 장용 -->
	

</mapper>
